syntax = "proto3";
package gunbuster;

import "common/ezbuy.proto";
import "common/empty.proto";

service Erp {
	rpc Ping(ErpPing) returns (ErpPingResp);
	// 仓库获取
	rpc WarehouseGet (ReqWarehouseGet) returns (RespWarehouseGet);
	// 增加地址
	rpc AddressAdd(ReqAddressAdd) returns (RespAddressAdd);
	// 更新地址
	rpc AddressUpdate (ReqAddressUpdate) returns (RespAddressUpdate);
	// 地址列表获取
	rpc AddressGet (ReqAddressGet) returns (RespAddressGet);
	// 获取用户
	rpc UserGet (ReqUserGet) returns (RespUserGet);
	// 用户状态获取
	rpc UserStateGet(ReqUserStateGet) returns (RespUserStateGet);
	// 任务状态基础表获取
	rpc TaskStatusGet (ReqTaskStatusGet) returns (RespTaskStatusGet);

	// 任务中心任务列表获取
	rpc TaskCenterGetAll (ReqTaskCenterGetAll) returns (RespTaskCenterGetAll);
	// 作废任务
	rpc CancelTask (ReqCancelTask) returns (RespCancelTask);
	// 结算任务
	rpc SettleTask (ReqSettleTask) returns (RespSettleTask);
	// 用户管理，生成账号
	rpc GenerateOutsourcingAccount (ReqGenerateOutsourcingAccount) returns (RespGenerateOutsourcingAccount);
	// 任务明细,拍单搜索
	rpc TaskDetailsGet (ReqUserTaskDetailsGet) returns (RespUserTaskDetailsGet);
	// 下载用户名下指定任务到 excel
	rpc TaskDownlod (ReqUserTaskDownlod) returns (RespUserTaskDownlod) {
		option (common.webapi).download = true;
	};
	rpc TaskExport (ReqTaskExport) returns (RespTaskExport) {
		option (common.webapi).download = true;
	};
	// 任务分配,用户分组获取订单
	rpc OrderAssignGroupByUserGet(ReqOrderAssignGroupByUserGet) returns (RespOrderAssignGroupByUserGet);
	// 任务分配,卖家分组获取订单
	rpc OrderAssignGroupByVendorGet(ReqOrderAssignGroupByVendorGet) returns (RespOrderAssignGroupByVendorGet);
	// 任务分配
	rpc OrderAssign (ReqOrderAssign) returns (RespOrderAssign);
	// 进入或重新进入众包
	rpc EntryReentryOutsourcing (ReqEntryReentryOutsourcing) returns (RespEntryReentryOutsourcing);

	//// Group 团队相关接口
	// CreateGroup 新建分组
	rpc CreateGroup(Group) returns (common.Empty);
	// UpdateGroup 更新分组信息
	rpc UpdateGroup(Group) returns (common.Empty);
	// InactiveGroups 删除分组
	rpc InactiveGroups(InactiveGroupsReq) returns (common.Empty);
	// GetGroups 获取active的分组
	rpc GetGroups(GetGroupsReq) returns (GetGroupsResp);
}

// ---------------------------------------------------------------------------

message Group{
	// create
	string groupName = 1;
	// not create
	int64 groupID = 2;
	string createBy = 3;
	int64 createDate = 4;
	string updateBy = 5;
	int64 updateDate = 6;
}

message InactiveGroupsReq{
	int64 groupID =1;
}

message GetGroupsReq{
	bool showInactive = 1;
}

message GetGroupsResp{
	repeated Group groups = 1;
}

message ErpPing {
	string Msg = 1;
}

message ErpPingResp {
	string Msg = 1;
}

message ReqWarehouseGet {
}

message RespWarehouseGet {
	repeated Warehouse Results = 1;
}

message Warehouse {
	int64 WarehouseId = 1;
	string WarehouseName = 2;
}

message ReqAddressAdd {
	// 仓库 Id
	int64 WarehouseId = 1;
	// 收件人
	string Addressee  = 2;
	// 电话
	string Phone = 3;
	// 邮编
	string PostCode = 4;
	// 地址
	string Address = 5;
}

message RespAddressAdd {
}

message ReqAddressUpdate {
	// 地址代号
	string AddressCode = 1;
	// 仓库 Id
	int64 WarehouseId = 2;
	// 收件人
	string Addressee  = 3;
	// 电话
	string Phone = 4;
	// 邮编
	string PostCode = 5;
	// 地址
	string Address = 6;
	// 启用禁用
	bool IsActive = 7;
}

message RespAddressUpdate {
}

enum AddressActiveOption {
	All = 0;
	Actived = 1;
	Inactived = 2;
}

message ReqAddressGet {
	// 仓库 Id， 可选
	int64 WarehouseId = 1;
	AddressActiveOption Acitve = 2;
}

message RespAddressGet {
	repeated Address Results = 1;
}

message Address {
	// 地址代码
	string AddressCode = 1;
	// 仓库 Id
	int64 WarehouseId = 2;
	// 收件人
	string Addressee  = 3;
	// 电话
	string Phone = 4;
	// 邮编
	string PostCode = 5;
	// 地址
	string Address = 6;
	// 启用禁用
	bool IsActive = 7;
}

message ReqUserGet {
	// 用户 Id 默认传0
	int64 UserId = 1;
}

message RespUserGet {
	repeated User Items = 1;
}

message User {
	string UserName = 1;
	int64 UserId = 2;
	int64 groupID = 3;
	string groupName =4;
}

message ReqUserStateGet {
	int64 UserId = 1;
}

message RespUserStateGet {
	// 用户名
	string UserName = 1;
	// 用户 Id
	int64 UserId = 2;
	// 订单数
	int64 OrderCount = 3;
	// 差额
	int64 Offset = 4;
	// 存在进行中任务
	bool HasPendingTask = 5;
}

message ReqTaskStatusGet {
}

message TaskStatus {
	// 任务状态 Id
	int64 TaskStatusId = 1;
	// 任务状态
	string TaskStatusDesc = 2;
}

message RespTaskStatusGet {
	repeated TaskStatus Items = 1;
}

message ReqTaskCenterGetAll {
	// 仓库 Id
	int64 WarehouseId = 1;
	// 地址代码
	string AddressCode = 2;
	// 任务状态
	int64 TaskStatusId = 3;
	// 领取人 id
	int64 UserId = 4;
	// 任务号
	string TaskNumber = 5;
	// 任务创建时间 [
	int64 CreateDateMin = 6;
	// 任务创建时间 ]
	int64 CreateDateMax = 7;
	// 分页
	int64 Page = 8;
	int64 Size = 9;
}

message RespTaskCenterGetAll {
	repeated Task Tasks = 1;
}

message Task {
	// 任务 Id
	int64 TaskId = 1;
	// 任务号
	string TaskNumber = 2;
	// 地址代码
	string AddressCode = 3;
	// 地址
	string Address = 4;
	// 创建日期
	int64 CreateDate = 5;
	// 领取日期
	int64 ReceiveDate = 6;
	// 领取用户 id
	int64 UserId = 7;
	// 领取用户名
	string UserName = 8;
	// sku 总数
	int64 OrderCount = 9;
	// sku 总价
	int64 TotalAmount = 10;
	// 已采购数量
	int64 PurchasedCount = 11;
	// 已采购价格
	int64 PurchasedAmount = 12;
	// 未采购价格
	int64 RemainAmount = 13;
	// 差额
	int64 Offset = 14;
	// 运费
	int64 ShippingFee = 15;
	// 结算金额
	int64 SettleAmount = 16;
	// 任务状态 id
	int64 TaskStatusId = 17;
	// 任务状态
	string TaskStatus = 18;
	// 可以作废
	bool CancelAble = 19;
	// 可以结算
	bool SettleAble = 20;
}

message ReqCancelTask {
	int64 TaskId = 1;
}

message RespCancelTask {
}

message ReqSettleTask {
	int64 TaskId = 1;
}

message RespSettleTask {
}

message ReqGenerateOutsourcingAccount {
	string Username = 1;
	string Password = 2;
	int64 groupID = 3;
}

message RespGenerateOutsourcingAccount {
}

message ReqUserTaskDownlod {
	int64 TaskId = 1;
}

message RespUserTaskDownlod {
	string contentType = 1;
	bytes data = 2;
	string filename = 3;
}

enum TaskExportSource {
	ErpExport = 0;
	ErpDownload = 1;
	GunbusterDownload = 2;
}

message ReqTaskExport {
	repeated int64 TaskIds = 1;
	ReqTaskCenterGetAll Req = 2;
	TaskExportSource Source = 3;
}

message RespTaskExport {
	string contentType = 1;
	bytes data = 2;
	string filename = 3;
}

message OrderAssignCommonReq {
	int64 WarehouseId = 1;
	int64 PayDateMin = 2;
	int64 PayDateMax = 3;
	RemarkOption RemarkOption = 4;
	int64 OrderAmountMin = 5;
	int64 OrderAmountMax = 6;
	int64 Page = 7;
	int64 Size = 8;
}

enum RemarkOption {
	RemarkAll = 0;
	RemarkYes = 1;
	RemarkNo = 2;
}

message PurcaseOrderIdVersionPair {
	int64 PurchaseOrderId = 1;
	int64 PurcahseOrderVersion = 2;
}

message ReqOrderAssignGroupByUserGet {
	OrderAssignCommonReq Req = 1;
}

message OrderUserGroup {
	repeated PurcaseOrderIdVersionPair IdVersionPairs = 1;
	string UserName = 2;
	int64 UserId = 3;
	string WarehouseName = 4;
	int64 WarehouseId = 5;
	int64 Paydate = 6;
	int64 Count = 7;
	int64 TotalAmount = 8;
}

message RespOrderAssignGroupByUserGet {
	repeated OrderUserGroup Orders = 1;
}

message ReqOrderAssignGroupByVendorGet {
	OrderAssignCommonReq Req = 1;
}

message OrderVendorGroup {
	repeated PurcaseOrderIdVersionPair IdVersionPairs = 1;
	string VendorName = 2;
	string WarehouseName = 3;
	int64 WarehouseId = 4;
	int64 Paydate = 5;
	int64 Count = 6;
	int64 TotalAmount = 7;
}

message RespOrderAssignGroupByVendorGet {
	repeated OrderVendorGroup Orders = 1;
}

enum ServiceTypeOption{
	AllService = 0;
	BuyForMe = 1;
	Other = 2;
}

message ReqUserTaskDetailsGet {
	int64 TaskId = 1;
	// 序列号
	int64 IdInTask = 2;
	// 商品名
	string ProductName = 3;
	// 卖家名
	string VendorName = 4;
	// SKU 状态
	int64 SKUStep = 5;
	// 页数
	int64 Page = 6;
	// 页面大小
	int64 Size = 7;
	// 服务类型
	ServiceTypeOption ServiceType = 8;
}

message OrderDetail {
	// 序列号
	int64 IdInTask = 1;
	// 商家名
	string VendorName = 2;
	// 商品名
	string ProductName = 3;
	// 商品链接
	string ProductURL = 4;
	// SKU
	string SKU = 5;
	// 单价
	int64 UnitPrice = 6;
	// 数量
	int64 Qty = 7;
	// 总价
	int64 TotalPrice = 8;
	// 下单账号
	string PlaceAccount = 9;
	// 采购单号
	string PONumber = 10;
	// 采购数量
	int64 PurchasedCount = 11;
	// 采购总价
	int64 PurchasedAmount = 12;
	// 差额
	int64 Offset = 13;
	// 运费
	int64 ShippingFee = 14;
	// Sku状态Id
	int64 SkuStepId = 15;
	// Sku状态
	string SkuStatus = 16;
	// 用户备注
	string Remark = 17;
	// 下单备注
	string PORemark = 18;
	// 问题标签
	string Label = 19;
	// 前台备注
	string FrontRemark = 20;
	// 附件备注
	string AttachmentRemark = 21;
	// 全局备注
	string GlobalRemark = 22;
	// 老采购备注
	string OldPurchaseRemark = 23;
	// NewOrderId
	int64 NewOrderId = 24;
	// NewOrderItemId
	int64 NewOrderItemId = 25;
	// 服务类型
	int64 ServiceTypeId = 26;
	// OperPurchaseOrderId
	int64 OperPurchaseOrderId = 27;
	// SKU properties
	string SKUProperties = 28;
	// order_id_mssql
	int64 OldOrderId = 29;
	// gpid
	int64 Gpid = 30;
	// skuid
	string SkuId = 31;
	// sku image url
	string SkuImageUrl = 32;
	// Actual pay
	int64 ActualPay = 33;
	// 实际数量
	int64 ActualQty = 34;
	// 实际单价
	int64 ActualUnitPrice = 35;
	// 实际运费
	int64 ActualShippingFee = 36;
	// PurchaseOrderVersion
	int64 PurchaseOrderVersion = 37;
}

message RespUserTaskDetailsGet {
	repeated OrderDetail Orders = 1;
	// 任务号
	string TaskNumber = 2;
	// 任务 Id
	int64 TaskId = 3;
	// 地址
	string Address = 4;
	// 收件人
	string Addressee = 5;
	// 电话
	string Phone = 6;
	// 邮编
	string PostCode = 7;
	// 订单数量
	int64 OrderCount = 8;
	// SKU 数量
	int64 SKUCount = 9;
	// 总价
	int64 TotalAmount = 10;
	// 已采购订单数量
	int64 PurchasedOrder = 11;
}

message GenerateTaskCond {
	// 仓库Id，若小于等于0，则忽略仓库，表示查所有仓库
	int64 WarehouseId = 1;
	// 付款时间，起始时间，传入值大于0，才会使用此条件，并且查询的内容是【大于等于】传入的值
	int64 PayDateStart = 2;
	// 付款时间，截止时间，传入值大于0，才会使用此条件，并且查询的内容是【小于等于】传入的值
	int64 PayDateEnd = 3;
	// 商品费（单价*数量），传入值大于0，才会使用此条件，并且查询的内容是【大于等于】传入的值
	double ProductTotalStart = 4;
	// 商品费（单价*数量），传入值大于0，才会使用此条件，并且查询的内容是【小于等于】传入的值
	double ProductTotalEnd = 5;
	// 备注类型【=0:全部，>0:有备注，<0:无备注】
	int64 RemarkType = 6;
	// 多少个订单生成一个任务，传入值小于等于0，则默认300
	int64 CountLimitInTask = 7;
	// 同一买家所有sku的价钱限制，传入值小于等于0，则默认100
	double TotalPriceLimit = 8;
}

message ReqOrderAssign {
	int64 UserId = 1;
	// 采购单Id 和 对应version 列表
	repeated PurcaseOrderIdVersionPair IdVersionPairs = 2;
	int64 WarehouseId = 3;
	string AddressCode = 4;
}

message RespOrderAssign {
}

enum EntryFrom {
	//未知
	Non = 0;
	//采购分配
	PurchaseAssign = 1;
	//采购管理
	PurchaseMgment = 2;
}

message PurchaseOrderEntity {
    int64 OperPurchaseOrderId = 1;
	int64 OrderIdMysql = 2;
	int64 OrderItemIdMysql = 3;
	int64 OrderIdMssql = 4;
	int64 OrderItemIdMssql = 5;
	int64 CustomerId = 6;
	string NickName = 7;
	int64 RegionId = 8;
	int64 ServiceTypeId = 9;
	int64 WarehouseId = 10;
	int64 ShipmentTypeId = 11;
	int64 OrderDate = 12;                 
	int64 BillCompleteDate = 14;
	int64 Gpid = 15;
	string SkuId = 16;
	string Remark = 17;
	int64 Qty = 18;
	int64 InternalUnitPrice = 19;
	int64 InternalTotalProductPrice = 20;
	int64 InternalShipmentFee = 21;
	string ProductName = 22;
	string AltProductName = 23;            
	string ProductUrl = 24;
	string SkuImgUrl = 25;
	string SkuProperties = 26;
	string Sku = 27;
	string AltSku = 28;
	string VendorName = 29;
	string ShopName = 30;
}

message PurchaseOrderRespEntity {
	int64 OperPurchaseOrderId = 1;
	bool IsSuccess = 2;
	string Msg = 3;
}

message ReqEntryReentryOutsourcing {
	repeated PurchaseOrderEntity Orders = 1;
	//从哪个入口进入众包
	EntryFrom From = 2;
}

message RespEntryReentryOutsourcing {
	repeated PurchaseOrderRespEntity Entities = 1;
}
