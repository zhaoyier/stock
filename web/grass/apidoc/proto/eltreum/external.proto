syntax = "proto3";
package eltreum;

import "common/ezbuy.proto";
import "eltreum/purchase.proto";

service External {
	rpc Ping(ExternalPing) returns (ExternalPingResp);
	// 获取目的地国家
	rpc CatalogGet (ReqGetById) returns (RespCatalogGet);
	// 获取采购地国家
	rpc ProSourceRegionGet (ReqGetById) returns (RespProSourceRegionGet);
	// 获取运输方式
	rpc ShipmentTypeGet(ShipmentTypeGetByRegion) returns (RespShipmentTypeGet);
	// 获取域名
	rpc DomainGet(ReqGetById) returns (RespDomainGet);
	// 获取问题标签
	rpc LabelGet (ReqLabelGetByModule) returns (RespLabelGet);
	// 获取仓库
	rpc WarehouseGet (ReqGetById) returns (RespWarehouseGet);
	// 获取淘宝账号
	rpc TaobaoAccountGet (ReqGetById) returns (RespTaobaoAccountGet);
	// 获取下单账号
	rpc PlaceAccountGet (ReqPlaceAccountGet) returns (RespPlaceAccountGet);
	// 获取下单账号
	rpc PlaceAccountGetByName (ReqPlaceAccountGetByName) returns (RespPlaceAccountGet);
	// 根据订单号和运输方式获取订单 item
	rpc OrderItemGetByShipment (ReqOrderItemGetByShipment) returns (RespOrderItemGetByShipment);
	// 查询已完成的采购单
	rpc GetCompletedOrders (ReqGetCompletedOrders) returns (RespGetCompletedOrders);
	// 通过OrderIdMysql、OrderItemIdMysql读取采购单号信息
	rpc LoadPoNumberInfoBySku (ReqLoadPoNumberInfoBySku) returns (RespLoadPoNumberInfoBySku);
	// 修改采购单号
	rpc ChangePoNumberBySku (ReqChangePoNumberBySku) returns (RespChangePoNumberBySku);
	// 修改ProductUrl
	rpc ChangeProductUrl (ReqChangeProductUrl) returns (RespChangeProductUrl);
	// 修改仓库
	rpc ChangeWarehouse (ReqChangeWarehouse) returns (RespChangeWarehouse);
	// 修改运输方式
	rpc ChangeShipmentTypeExternal (ReqChangeShipmentTypeExternal) returns (RespChangeShipmentTypeExternal);
	// 查询派送信息
	rpc GetShipmentInfo (ReqGetShipmentInfo) returns (RespGetShipmentInfo);
	// 查询OrderItem信息
	rpc GetOrderItemsInfo (ReqGetOrderItemsInfo) returns (RespGetOrderItemsInfo);
	// 通过ShipmentId查询派送信息
	rpc GetShipmentInfoByShipmentId (ReqGetShipmentInfoByShipmentId) returns (RespGetShipmentInfoByShipmentId);
	// 查询商品Cid
	rpc GetCids (ReqGetCids) returns (RespGetCids);
	// 通过老系统OrderId获取响应的下单账号
	rpc GetPlaceAccountByOldOrderId (ReqGetPlaceAccountByOldOrderId) returns (RespGetPlaceAccountByOldOrderId);
	// 获取订单的warehouseId
	rpc GetWarehouse (ReqGetWarehouse) returns (RespGetWarehouse);
	// 提供查询备注服务，传入老订单id列表
	rpc LoadRemarkByOldOrderIds(ReqLoadRemarkByOldOrderIds) returns (RespLoadRemarkByOldOrderIds);

	rpc SearchOrders (ReqSearchOrders) returns (RespSearchOrders);
	rpc OrderDetails (ReqOrderDetails) returns (RespOrderDetails);

// ---------------------------------------------------------------------------
	// 众包下单回调
	rpc PlaceOrderForOutSourcing (ReqPlaceOrderForOutSourcing) returns (RespPlaceOrderForOutSourcing) {
		option (common.timeout) = "60s";
	};
	// 众包问题单回调
	rpc IssueOrderForOutSourcing (ReqIssueOrderForOutSourcing) returns (RespIssueOrderForOutSourcing) {
		option (common.timeout) = "60s";
	};
	// 众包备注回调
	rpc PurchaseRemarkForOutSourcing (ReqPurchaseRemarkForOutSourcing) returns (RespPurchaseRemarkForOutSourcing) {
		option (common.timeout) = "60s";
	};
// ---------------------------------------------------------------------------

	// 查询某个时间节点没有回复的skus
	rpc GetExpiredSkusByDate(GetExpiredSkusByDateReq) returns(GetExpiredSkusByDateResp);

	// 工单系统查询订单信息接口
	rpc GetTicketOrders(NewOrderKeys) returns(TicketOrders);

	//IsOrderEzseller 是否是卖家订单
	rpc IsOrderEzseller(IsOrderEzsellerReq) returns (IsOrderEzsellerResp);

	// 获取物流商信息
	rpc GetLogisticsCompany (ReqGetLogisticsCompany) returns (RespGetLogisticsCompany);

	// 获取Sku退单信息
	rpc GetSkuPreCancelInfo (ReqGetSkuPreCancelInfo) returns (RespGetSkuPreCancelInfo);
	// GetBuyerTypeByPoID 根据采购ID获取采购员类型
	rpc GetBuyerTypeByPoID(GetBuyerTypeByPoIDReq) returns (GetBuyerTypeByPoIDResp);
	// GetDomainTypeBySKUs 根据SKU获取订单类型
	// 如果skus对应的订单类型为多个时 直接会报错
	rpc GetDomainTypeBySKUs(GetDomainTypeBySKUsReq) returns (GetDomainTypeBySKUsResp);
}

// ---------------------------------------------------------------------------

enum DomainType{
	DomainTypeOther = 0;
	DomainTypeTaoBao = 1;
	DomainTypeEZSeller = 2;
}

message GetDomainTypeBySKUsReq{
	repeated NewOrderKey skus = 1;
}

message GetDomainTypeBySKUsResp{
	DomainType domain = 1;
}

message GetBuyerTypeByPoIDReq{
	int64 PoID = 1;
}

message GetBuyerTypeByPoIDResp{
	BuyerAccountType buyerAccountType = 1;
	// 如果是腾云用户 会带上groupName
	string groupName = 2;
}

message IsOrderEzsellerReq{
	 int64 poID = 1;
}

message IsOrderEzsellerResp{
	bool ok = 1;
}

message ExternalPing {
	string Msg = 1;
}

message ExternalPingResp {
	string Msg = 1;
}

message ReqGetById {
	int64 Id = 1;
}

message ShipmentTypeGetByRegion {
	// shipment type id
	int64 Id = 1;
	// region id
	int64 RegionId = 2;
}

enum IssueLabelModule {
	PurchaseMgr = 0;
	ArrivalMgr = 1;
	PackingMgr = 2;
	ReceivingMgr = 3;
	TrackingOrderMgr = 4;
}

message ReqLabelGetByModule {
	IssueLabelModule Module = 1;
}

message TaobaoAccount {
	// 淘宝账号 Id
	int64 TaobaoAccountId = 1;
	// 昵称
	string NickName = 2;
	// 状态
	bool Status = 3;
	// 国家
	string CatalogCode = 4;
	// 订单后缀
	string OrderSuffix = 5;
	// 支付宝账号
	string AlipayAccount = 6;
	// 公司
	string CompanyName = 7;
}

message RespTaobaoAccountGet {
	repeated TaobaoAccount Accounts = 1;
}

message ReqPlaceAccountGet {

}

message ReqPlaceAccountGetByName{
	string accountName = 1;
}

message PlaceAccountEntity {
	int64 Id = 1;
	string PlaceAccount = 2;
}

message RespPlaceAccountGet {
	repeated PlaceAccountEntity Entities = 1;
}

message ReqOrderItemGetByShipment {
	int64 OrderId = 1;
	int64 ShipmentTypeId = 2;
}

message OrderItemsByShipment {
	int64 OrderItemId = 1;
	int64 Weight = 2;
	int64 VolumeWeight = 3;
	int64 Qty = 4;
}

message RespOrderItemGetByShipment {
	repeated OrderItemsByShipment OrderItems = 1;
}

message ReqGetCompletedOrders {
	//上次查询的最大Id，假设上次查询到的Id为100，那么此次将查询   >100 开始查询，默认传0，表示从  >0 开始查，如果需要不用此值查询，传【负值】
	int64 LastMaxIndexId = 1;
	//上次查询的最大的创建时间，假设上次查询到的最大创建时间是 100，那么此次从 >100 开始查询，如果不需要用此值查询，传【<=0的值】
	int64 LastMaxCreateDate = 2;
	//要查询多少条数据
	int64 Size = 3;
}

message GetCompletedOrdersEntity {
	int64 Id = 1;
	int64 OrderIdMssql = 2;
    int64 OrderItemIdMssql = 3;
	int64 OrderIdMysql = 4;
    int64 OrderItemIdMysql = 5;
    // 采购单号，多个的话，会以逗号隔开
    string PoNumbers = 6;
    string VendorName = 7;
	int64 CreateDate = 8;
	string OrderNumber = 9;
	//平台类型，[0,1]淘宝，[2]天猫，[3]京东，[4]楚楚街，[5]蘑菇街
	int64 SourceType = 10;
}

message RespGetCompletedOrders {
	repeated GetCompletedOrdersEntity Entities = 1;
}

message ReqLoadPoNumberInfoBySku {
	int64 OrderIdMysql = 1;
	int64 OrderItemIdMysql = 2;
}

message LoadPoNumberInfoBySkuEntity {
	// 采购记录 Id
	int64 Id = 1;
	// 采购单号
	string PoNumber = 2;
	// 采购地单价
	double InternalUnitPrice = 3;
	// 国内运费采购地
	double InternalShipmentFee = 4;
	// 采购数量
	int64 Qty = 5;
	// 是否外网
	bool IsOutSite = 6;
	// 下单账号
	string PlaceAccount = 7;
}

message RespLoadPoNumberInfoBySku {
	repeated LoadPoNumberInfoBySkuEntity LoadPoNumberInfoBySkuEntities = 1;
}

message ChangePoNumberEntity {
	// 采购的PoId，如果是修改，此值必须传，如果是新增，此值传0
	int64 PoId = 1;
	// 采购单号
	string PoNumber = 2;
	// 采购单价
	double InternalUnitPrice = 3;
	// 运费
	double InternalShipmentFee = 4;
	// 采购数量
	int64 Qty = 5;
	// 是否外网
	bool IsOutSite = 6;
	// 下单账号
	string PlaceAccount = 7;
}

message ReqChangePoNumberBySku {
	int64 OrderIdMysql = 1;
	int64 OrderItemIdMysql = 2;
	repeated ChangePoNumberEntity Entities = 3;
}

message RespChangePoNumberBySku {

}

message ReqChangeProductUrl {
	int64 OrderIdMysql = 1;
	int64 OrderItemIdMysql = 2;
	string ProductUrl = 3;
	string Remark = 4;
}

message RespChangeProductUrl{

}

message ReqChangeWarehouse {
	int64 OrderIdMysql = 1;
	int64 OrderItemIdMysql = 2;
	//新的仓库Id，需要根据dic库的dic_warehouse里面的值一致
	int64 NewWarehouseId = 3;
	//当前环节最小可以允许的状态Id
	int64 MinOrderItemStatus = 4;
	//修改仓库的备注
	string Remark = 5;
}

message RespChangeWarehouse {

}

message ChangeShipmentTypeExternalOrderInfo {
	int64 OrderIdMysql = 1;
	int64 OrderItemIdMysql = 2;
}

message ReqChangeShipmentTypeExternal {
	//订单信息
	repeated ChangeShipmentTypeExternalOrderInfo OrderInfos = 1;
	//运输方式Id
	int64 ShipmentTypeId = 2;
	//备注
	string Remark = 3;
	//UserId
	int64 UserId = 4;
	//UserName
	string UserName = 5;
	//最小的Item状态值
	int64 MinItemStatus = 6;
}

message RespChangeShipmentTypeExternal {

}

message ReqGetShipmentInfo {
	int64 OrderIdMysql = 1;
	//运输方式Id
	int64 ShipmentTypeId = 2;
}

message RespGetShipmentInfo {
	int64 ShipmentId = 1;
	//收件人地址
	string ShipToAddress = 2;
	//收件人电话
	string ShipToPhone = 3;
	//收件人邮编
	string ShipToZip = 4;
	//收件人名字
	string ShipToName = 5;
	//站点类型Id
	int64 StationTypeId = 6;
	//取货时间段Id
	int64 PickupPeriodId = 7;
	//派送类型Id
	int64 DeliveryTypeId = 8;
	//派送站点Id
	int64 DeliveryStationId = 9;
	//客户Id
	int64 CustomerId = 10;
	//收件人州名
	string ShipToState = 11;
	//取货时间段类型Id
	int64 PickPeriodTypeId = 12;
	//国际运费
	int64 ShippingFee = 13;
}

message ReqGetShipmentInfoByShipmentId {
	int64 ShipmentId = 1;
}

message RespGetShipmentInfoByShipmentId {
	int64 ShipmentId = 1;
	//收件人地址
	string ShipToAddress = 2;
	//收件人电话
	string ShipToPhone = 3;
	//收件人邮编
	string ShipToZip = 4;
	//收件人名字
	string ShipToName = 5;
}

message ReqGetOrderItemsInfoEntity {
	int64 OrderId = 1;
	int64 OrderItemId = 2;
}

message RespGetOrderItemsInfoEntity {
	int64 OrderId = 1;
	int64 OrderItemId = 2;
	//国际运费
	int64 ShippingFee = 3;
}

message ReqGetOrderItemsInfo {
	repeated ReqGetOrderItemsInfoEntity Entities = 1;
}

message RespGetOrderItemsInfo {
	repeated RespGetOrderItemsInfoEntity Entities = 1;
}

message GetCidsEntity {
	//传入、传出
	int64 OrderIdMysql = 1;
	//传入、传出
	int64 OrderItemIdMysql = 2;
	//传出
	int64 Cid = 3;
}

message ReqGetCids {
	repeated GetCidsEntity Entities = 1;
}

message RespGetCids {
	repeated GetCidsEntity Entities = 1;
}

message ReqGetPlaceAccountByOldOrderId {
	//老系统订单Id
	int64 OrderIdMssql = 1;
}

message RespGetPlaceAccountByOldOrderId {
	//下单账号
	string PlaceAccount = 1;
}
message ReqSearchOrders {
		// 页码
		int64 Page = 1;
		// 页面大小
		int64 Size = 2;
		// order_id_mysql _ order_item_id_mysql
		string OrderNumberSku = 3;
		// 付款号
		string PaymentNumber = 4;
		// 昵称
		string Nickname  = 5;
		// 国家 Id
		int64 RegionId = 6;
		// 付款时间最小值
		int64 PayDateMin = 7;
		// 付款时间最大值
		int64 PayDateMax = 8;
		// 采购来源地 Id
		int64 ProsourceRegionId = 9;
		// 运输方式 Id
		int64 ShipmentTypeId = 10;
		// 仓库 Id
		int64 WarehouseId = 11;
		// 淘宝账号 Id
		int64 TaobaoAccountId = 12;
		// 商品名
		string ProductName = 13;
		// 卖家名
		string VendorName = 14;
		// 服务类型 Id
		int64 ServiceTypeId = 15;
		// 采购 Id
		int64 PurchaseOrderId = 16;
		// 采购单号
		string PoNumber = 17;
		// 域名
		int64 domainID = 18;
}

message RespSearchOrders {
		// 订单
		repeated Order Orders= 1;
		// 总数
		int64 Total = 2;
}

message Order {
	// order_id_mysql _ order_item_id_mysql
	string OrderNumberSku = 1;
	//
	int64 PurchaseOrderId = 2;
	// 仓库 id
	int64 WarehouseId = 3;
	// 仓库名
	string WarehouseName = 4;
	// 国家 id
	int64 RegionId = 5;
	// 国家名
	string RegionName = 6;
	// 运输方式 id
	int64 ShipmentTypeId = 7;
	// 运输方式
	string ShipmentTypeName = 8;
	// 客户 id
	int64 CustomerId = 9;
	// 客户名
	string CustomerName = 10;
	// 商品名
	string ProductName = 11;
	// 商家名
	string VendorName = 12;
	// 单价
	int64 UnitPrice = 13;
	// 国内运费
	int64 DomesticShippingFee = 14;
	// 重量
	int64 Weight = 15;
	// 体积重
	int64 VolumeWeight = 16;
	// 数量
	int64 Qty = 17;
	// 已采购数量
	int64 PurchasedQty = 18;
	// 备注
	string Remark = 19;
	// 商品链接
	string ProductUrl = 20;
	// 老订单号
	string OldOrderNumber = 21;
	// 采购单号
	string PoNumber = 22;
}

message ReqOrderDetails {
	int64 PurchaseOrderId = 1;
}

message RespOrderDetails {
	// SKU 号
	string OrderNumberSku = 1;
	// 服务类型 Id
	int64 ServiceTypeId = 2;
	// 昵称
	string NickName = 3;
	// 差额补齐
	int64 Offset = 4;
	// 商家名
	string VendorName = 5;
	// 采购单号
	string PONumber = 6;
	// 采购账号
	string PurchaseAccount = 7;
	// 是否闪购
	bool IsFlashSale = 8;
	// 支付时间
	int64 PayDate = 9;
	// 采购时间
	int64 PurchaseDate = 10;
	// 备注
	string Remark = 11;
	// 商品名
	string ProductName = 12;
	// 商品链接
	string ProductUrl = 13;
	// 重量
	int64 Weight = 14;
	// 体积重
	int64 VolumeWeight = 15;
	// SKU
	string SKU = 16;
	// 数量
	int64 Qty = 17;
	// 实际数量
	int64 ActualQty = 18;
	// 单价
	int64 UnitPrice = 19;
	// 实际单价
	int64 ActualUnitPrice = 20;

	// 域名
	int64 DomainId = 21;
	string DomainName = 22;

	// 服务类型
	string ServiceTypeName = 23;

	// 老订单号
	string OldOrderNumber = 24;

	int64 Status = 25;
	string StatusName = 26;
}

message ReqPlaceOrderForOutSourcing {
	// 采购单Id
	int64 PurchaseOrderId = 1;
	// 采购单号
	string PoNumber = 2;
	// 采购单价
	double InternalUnitPrice = 3;
	// 国内运费
	double InternalShipmentFee = 4;
	// 采购数量
	int64 Qty = 5;
	// 是否外网
	bool IsOutSite = 6;
	// 下单账号
	string PlaceAccount = 7;
	// 下单人
	string UserName = 8;
	// 实付金额
	double ActualPay = 9;
	// 下单Ip
	string Ip = 10;
	// 实付金额
	string ReceivingAddress = 11;
	// 操作来源Id
	int64 OperateSourceId = 12;
	// 操作人UserId
	int64 OperateUserId = 13;
	// Ezbuy商品总价(无需前端传入，所以用int64)
	int64 EzbuyProductTotal = 14;
	// Taobao商品总价(无需前端传入，所以用int64)
	int64 TaobaoProductTotal = 15;
	// 按比例分摊的实付金额(无需前端传入，所以用int64)
	int64 RatioActualPay = 16;
}

message RespPlaceOrderForOutSourcing {

}

message OrderLabelForOutSourcingEntity {
	//采购订单Id
	int64 OperPurchaseOrderId = 1;
	//标签Id
	int64 IssueLabelId = 2;
	//是否有效
	bool IsActive = 3;
	//创建人
	string CreateBy = 4;
	//修改人
	string UpdateBy = 5;
	//创建时间
	int64 CreateDate = 6;
	//修改时间
	int64 UpdateDate = 7;
}

message ReqIssueOrderForOutSourcing {
	// 问题单回写
	repeated OrderLabelForOutSourcingEntity Entities = 1;
}

message RespIssueOrderForOutSourcing {

}

message ReqPurchaseRemarkForOutSourcing {
	// 采购单Id
	int64 PurchaseOrderId = 1;
	// 备注内容
	string Content = 2;
	// 操作人
	string UserName = 3;
}

message RespPurchaseRemarkForOutSourcing {

}

message ReqGetWarehouse {
	repeated ReqGetWarehouseEntity Entities = 1;
}

message ReqGetWarehouseEntity {
	int64 orderId = 1;
	int64 orderItemId = 2;
}

message RespGetWarehouse {
	repeated RespGetWarehouseEntity Entities = 1;
}

message RespGetWarehouseEntity {
	int64 orderId = 1;
	int64 orderItemId = 2;
	int64 WarehouseId = 3;
}

message ReqLoadRemarkByOldOrderIds {
	//需要查询备注的OrderId列表
	repeated int64 MssqlOrderIds = 1;
}

message RespLoadRemarkByOldOrderIdsEntity {
	//MssqlOrderId
	int64 MssqlOrderId = 1;
	//等待客户答复
	bool PendingReply = 2;
	//客户已答复，等待处理
	bool PendingAttention = 3;
	//最后一条前台备注
	string FrontRemark = 4;
	//最后一条全局备注
	string AlwaysRemark = 5;
	//附件Url
	string Attachment = 6;
	// 采购备注
	string PurchaseRemark = 7;
	string FrontRemarkBy = 8;
	int64 FrontRemarkDate = 9;
	//验货环节全局备注
	string GlobalRemark = 10;
	string GlobalRemarkBy = 11;
	int64 GlobalRemarkDate = 12;
	//商品备注
	string ProductRemark = 13;
	string ProductRemarkBy = 14;
	int64 ProductRemarkDate = 15;
}

message RespLoadRemarkByOldOrderIds {
	//返回的结果集
	repeated RespLoadRemarkByOldOrderIdsEntity Entities = 1;
}


message OrderPairHasExpired {
	int64 orderId = 1;
	int64 orderItemId = 2;
	bool isExpired = 3;
}

message GetExpiredSkusByDateReq {
	string stepName = 1;
	int64 createDate = 2;
}

message GetExpiredSkusByDateResp {
	repeated OrderPairHasExpired pairs = 1;
}

message NewOrderKey {
	int64 orderId = 1;
	int64 orderItemId = 2;
}

message NewOrderKeys {
	repeated NewOrderKey items = 1;
}

enum BuyerAccountType {
	INVALID_BUYER_ACCOUNT_TYPE = 0;
	ERP = 1;
	// 腾云
	GUNBUSTER = 2;
	// 卖家
	EZSELLER = 3;
}

message TicketOrder {
	string poNumber = 1;
	string taobaoAccountNo = 2;
	string buyerAccount = 3;
	int64 buyerAccountId = 4;
	string buyerName = 5;
	BuyerAccountType buyerAccountType = 6;
	int64 warehouseId = 7;
	int64 orderPurchaseDate = 8;
	string oldOrderNumber = 9;
	string productName = 10;
	string productUrl = 11;
	int64 orderIdMssql = 12;
	int64 operateSourceId = 13;
	int64 operateUserId = 14;
	int64 orderItemIdmssql= 15;
	int64 internalTotalProductPrice= 16;
	int64 qty= 17;
	int64 purchaseOrderID = 18;
	string vendorName = 19;
}

message TicketOrders {
	repeated TicketOrder items = 1;
}

message ReqGetLogisticsCompany {}

message RespGetLogisticsCompany {
	repeated LogisticsCompanyInfo Entities = 1;
}

message LogisticsCompanyInfo {
	int64 Id = 1;
	string Name = 2;
}

enum CancelEntry {
	EntrySearchOrder = 0;
	EntryPurchase = 1;
	EntryStockIn = 2;
	EntryTrackingOrder = 3;
	// 补拍
	EntryRepurchase = 4;
}

message ReqGetSkuPreCancelInfo {
	// 老订单号
	string OrderNumber = 1;
	CancelEntry entry = 2;
	string skuNumber = 3;
}

message RespGetSkuPreCancelInfo {
	// 最小退单状态
	int64 MinStatusId = 1;
	// 是否禁止退单
	bool IsForbidden = 2;
	string forbiddenMsg = 3;
}
