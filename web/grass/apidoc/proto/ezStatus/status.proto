syntax = "proto3";
package status;

// parcel 包裹，可能会有多个订单
// package 二级包裹，运输时的最小单位
// order 订单，可能会有多个package
// orderItem 商品的最小单位（对应sku），但有可能会被分在多个package中

message NewParcelStatus {
    int64 id = 1;
    enum ParcelNewStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
    }
    ParcelNewStatus status = 2;
    int64 timeSecond = 3;
    string content = 4;
}

message NewOrderStatusBatch {
    repeated NewOrderStatus orders = 1;
}

message NewOrderStatus {
    int64 id = 1;
    enum OrderNewStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
        PENDING_PAYMENT = 1000; // 待付款
        PAYED = 1900; // 已付款
        FINISH = 21000; // 完成
    }
    OrderNewStatus status = 2;
    string content = 3;
}

enum PackageNewStatus {
    ILLEGALITY = 0; // 非法状态
    CANCEL = 1; // 已取消
    // 采购和仓库还没有二级包裹概念
    SKU_PACKED = 8600; // 已打包
    SKU_SEPARATE_PICKING = 8750; // 已分拣
    SEND_OUT = 9000; // 已出库
    INTERNATIONAL = 10000; // 国际物流处理中
    PENDING_CUSTOMS_DECLARATION = 11300; // 待处理报关
    CUSTOMS_DECLARATION = 11600; // 已处理报关
    PENDING_INTERNATIONAL_LOGISTICS = 12300; // 国际运输待起运
    INTERNATIONAL_LOGISTICS_START = 12600; // 国际运输已起运
    ARRIVE_CUSTOMHOUSE = 13250; // 已到达海关
    DOING_CUSTOMS_LIQUIDATION = 13500; // 清关处理中
    SKU_CUSTOMS_LIQUIDATION = 13750; // 已清关
    SKU_EZBUY_STORE_ARRIVE = 14300; // 已到达ezbuy仓库
    SKU_EZBUY_STORE_PUTAWAY = 14600; // ezbuy仓库已上架
    PENDING_CLAIM_GOODS_PLAN = 15000; // 待安排取货
    PENDING_SEND = 16000; // 待派送
    SEND_PLAN = 17000; // 派送处理中
    SEND_PLAN_PENDING_DRIVER = 17100; // 待分配司机
    SEND_PLAN_DRIVER = 17200; // 已分配司机
    SEND_PLAN_PENDING_JOB = 17300; // 待分配任务
    SEND_PLAN_JOB = 17400; // 已分配任务
    SEND_PLAN_PICKING = 17500; // 已拣货
    SEND_PLAN_PENDING_FIND = 17600; // 待找货
    SEND_PLAN_PENDING_TRUCK = 17700; // 待装车
    SENDING = 18000; // 派送中
    SENDING_SELF_PICK = 19000; // 送往自取仓库
    SELF_PICK_STORE_ARRIVE = 20300; // 到达自取仓库
    SELF_PICK_STORE_PUTAWAY = 20700; // 到达自取仓库
    FINISH = 21000; // 完成
}

message NewPackageStatusBatch {
    repeated int64 id = 1;
    PackageNewStatus status = 2;
    int64 timeSecond = 3;
    string content = 4;
    string operator = 5;
}
message NewPackageStatus {
    int64 id = 1;
    PackageNewStatus status = 2;
    int64 timeSecond = 3;
    string content = 4;
    string operator = 5;
}

message NewOrderItemStatusBatch {
    repeated NewOrderItemStatus statusList = 1;
}

message ForceNewOrderItemStatusBatch {
    repeated int64 orderId = 1;
    NewOrderItemStatus.OrderItemNewStatus status = 2;
    int64 timeSecond = 3;
    string content = 4;
    string operator = 5;
}

message CASNewOrderItemStatus {
    int64 orderId = 1;
    int64 orderItemId = 2;
    NewOrderItemStatus.OrderItemNewStatus fromStatus = 3;
    NewOrderItemStatus.OrderItemNewStatus toStatus = 4;
    int64 timeSecond = 5;
    string content = 6;
    string operator = 7;
}

message CASNewOrderItemStatusFromMultiStatus {
    int64 orderId = 1;
    int64 orderItemId = 2;
    repeated NewOrderItemStatus.OrderItemNewStatus fromStatus = 3;
    NewOrderItemStatus.OrderItemNewStatus toStatus = 4;
    int64 timeSecond = 5;
    string content = 6;
    string operator = 7;
}

message NewOrderItemStatus {
    int64 orderId = 1;
    int64 orderItemId = 2;
    enum OrderItemNewStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
        SKU_PENDING_DISPOSE = 2200; // 待处理
        SKU_PENDING_VERIFICATION = 2250; //待确认支付
        SKU_GROUPBUY_PENDING = 2350; // 等待成团(拼团特有的状态)
        SKU_PENDING_ALLOCATION = 2500; // 待分配
        SKU_PURCHASING = 2700; // 采购中
        PURCHASING_ORDER = 3000; // 采购已下单
        PURCHASING_SEND_OUT = 4000; // 采购卖家已发货
        PURCHASING_SEND = 5000; // 采购快递派送中
        PURCHASING_GET = 6000; // 采购仓库已签收
        SKU_EXAMINED = 7300; // 已验货，待上架
        SKU_PUTAWAY = 7600; // 已上架
        PENDING_PICKING_ALLOCATION = 8150; // 待分配拣货
        PICKING_ALLOCATION = 8300; // 已分配拣货
        SKU_PICKING = 8450; // 已拣货
        SKU_PACKED = 8600; // 已打包
        // 打包之后生成二级包裹，后面操作的就都是二级包裹了
    }
    OrderItemNewStatus status = 3;
    int64 timeSecond = 4;
    string content = 5;
    string operator = 6;
}

message UpdateResultBatch {
    repeated UpdateResult results = 1;
}

message UpdateResult {
    enum ErrorCode {
        SUCCESS = 0;
        SYSTEM_ERROR = 1; // 系统错误，如数据库报错等
        ILLEGAL_CHANGE = 100; // 非法变更
    }
    ErrorCode code = 1;
}

message OrderItemBatchUpdateResult {
    UpdateResult result = 1; // 操作结果，需要检查错误码
    repeated OrderItem orderItems = 2; // 操作成功的orderItem列表
}

message OrderItemBatch {
    repeated OrderItem items = 1;
}

message OrderItem {
    int64 orderId = 1;
    int64 orderItemId = 2;
}

message Package {
    int64 id = 1;
}

message Parcel {
    int64 id = 1;
}

message Order {
    int64 id = 1;
}

message OrderBatch {
    repeated Order orders = 1;
}

message OrderStatusResultBatch {
    repeated OrderStatusResult orders = 1;
}

message OrderStatusResult {
    int64 id = 1;
    enum OrderStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
        PENDING_PAYMENT = 1000; // 待付款
        PURCHASING = 2000; // 采购中
        SKU_GROUPBUY_PENDING = 2350; // 等待成团(拼团特有的状态)
        PURCHASING_ORDER = 3000; // 采购已下单
        PURCHASING_SEND_OUT = 4000; // 采购卖家已发货
        PURCHASING_SEND = 5000; // 采购快递派送中
        PURCHASING_GET = 6000; // 采购仓库已签收
        PURCHASING_IN_STORE = 7000; // 采购仓库已入库，待发货
        PENDING_SEN_OUT = 8000; // 待发货
        SEND_OUT = 9000; // 已出库
        INTERNATIONAL = 10000; // 国际物流处理中
        CHECK_OUT = 11000; // 出关
        INTERNATIONAL_LOGISTICS = 12000; // 国际运输中
        CUSTOMS_LIQUIDATION = 13000; // 清关
        PICK_UP = 14000; // ezbuy提货
        PENDING_CLAIM_GOODS_PLAN = 15000; // 待安排取货
        PENDING_SEND = 16000; // 待派送
        SEND_PLAN = 17000; // 派送处理中
        SENDING = 18000; // 派送中
        SENDING_SELF_PICK = 19000; // 送往自取仓库
        SELF_PICK_STORE = 20000; // 到达自取仓库
        FINISH = 21000; // 完成
    }
    OrderStatus status = 2;
    QueryResult result = 3; // 查询是否成功
}

message ParcelStatusResult {
    int64 id = 1;
    enum ParcelStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
        PENDING_STORE = 990; // 待入库
        PENDING_SEN_OUT = 8000; // 待发货
        SEND_OUT = 9000; // 已出库
        INTERNATIONAL = 10000; // 国际物流处理中
        CHECK_OUT = 11000; // 出关
        INTERNATIONAL_LOGISTICS = 12000; // 国际运输中
        CUSTOMS_LIQUIDATION = 13000; // 清关
        PICK_UP = 14000; // ezbuy提货
        PENDING_CLAIM_GOODS_PLAN = 15000; // 待安排取货
        PENDING_SEND = 16000; // 待派送
        SEND_PLAN = 17000; // 派送处理中
        SENDING = 18000; // 派送中
        SENDING_SELF_PICK = 19000; // 送往自取仓库
        SELF_PICK_STORE = 20000; // 到达自取仓库
        FINISH = 21000; // 完成
    }
    ParcelStatus status = 2;
    QueryResult result = 3; // 查询是否成功
}

// 二级包裹
message PackageStatusResult {
    int64 id = 1;
    enum PackageStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
        // 采购和仓库还没有二级包裹概念
        SKU_PACKED = 8600; // 已打包
        SKU_SEPARATE_PICKING = 8750; // 已分拣
        SEND_OUT = 9000; // 已出库
        INTERNATIONAL = 10000; // 国际物流处理中
        PENDING_CUSTOMS_DECLARATION = 11300; // 待处理报关
        CUSTOMS_DECLARATION = 11600; // 已处理报关
        PENDING_INTERNATIONAL_LOGISTICS = 12300; // 国际运输待起运
        INTERNATIONAL_LOGISTICS_START = 12600; // 国际运输已起运
        ARRIVE_CUSTOMHOUSE = 13250; // 已到达海关
        DOING_CUSTOMS_LIQUIDATION = 13500; // 清关处理中
        SKU_CUSTOMS_LIQUIDATION = 13750; // 已清关
        SKU_EZBUY_STORE_ARRIVE = 14300; // 已到达ezbuy仓库
        SKU_EZBUY_STORE_PUTAWAY = 14600; // ezbuy仓库已上架
        PENDING_CLAIM_GOODS_PLAN = 15000; // 待安排取货
        PENDING_SEND = 16000; // 待派送
        SEND_PLAN = 17000; // 派送处理中
        SEND_PLAN_PENDING_DRIVER = 17100; // 待分配司机
        SEND_PLAN_DRIVER = 17200; // 已分配司机
        SEND_PLAN_PENDING_JOB = 17300; // 待分配任务
        SEND_PLAN_JOB = 17400; // 已分配任务
        SEND_PLAN_PICKING = 17500; // 已拣货
        SEND_PLAN_PENDING_FIND = 17600; // 待找货
        SEND_PLAN_PENDING_TRUCK = 17700; // 待装车
        SENDING = 18000; // 派送中
        SENDING_SELF_PICK = 19000; // 送往自取仓库
        SELF_PICK_STORE_ARRIVE = 20300; // 到达自取仓库
        SELF_PICK_STORE_PUTAWAY = 20700; // 到达自取仓库
        FINISH = 21000; // 完成
    }
    PackageStatus status = 2;
}

message OrderItemStatusResultBatch {
    repeated OrderItemStatusResult statusList = 1;
}

message OrderItemStatusResult {
    int64 orderId = 1;
    int64 orderItemId = 2;
    enum OrderItemStatus {
        ILLEGALITY = 0; // 非法状态
        CANCEL = 1; // 已取消
        SKU_PENDING_DISPOSE = 2200; // 待处理
        SKU_GROUPBUY_PENDING = 2350; // 等待成团(拼团特有的状态)
        SKU_PENDING_ALLOCATION = 2500; // 待分配
        SKU_PURCHASING = 2700; // 采购中
        PURCHASING_ORDER = 3000; // 采购已下单
        PURCHASING_SEND_OUT = 4000; // 采购卖家已发货
        PURCHASING_SEND = 5000; // 采购快递派送中
        PURCHASING_GET = 6000; // 采购仓库已签收
        SKU_EXAMINED = 7300; // 已验货，待上架
        SKU_PUTAWAY = 7600; // 已上架
        PENDING_PICKING_ALLOCATION = 8150; // 待分配拣货
        PICKING_ALLOCATION = 8300; // 已分配拣货
        SKU_PICKING = 8450; // 已拣货
        SKU_PACKED = 8600; // 已打包
        SKU_SEPARATE_PICKING = 8750; // 已分拣
        BOXED = 9100; // 已封箱
        INTERNATIONAL = 10000; // 国际物流处理中
        PENDING_CUSTOMS_DECLARATION = 11300; // 待处理报关
        CUSTOMS_DECLARATION = 11600; // 已处理报关
        PENDING_INTERNATIONAL_LOGISTICS = 12300; // 国际运输待起运
        INTERNATIONAL_LOGISTICS_START = 12600; // 国际运输已起运
        ARRIVE_CUSTOMHOUSE = 13250; // 已到达海关
        DOING_CUSTOMS_LIQUIDATION = 13500; // 清关处理中
        SKU_CUSTOMS_LIQUIDATION = 13750; // 已清关
        SKU_EZBUY_STORE_ARRIVE = 14300; // 已到达ezbuy仓库
        SKU_EZBUY_STORE_PUTAWAY = 14600; // ezbuy仓库已上架
        PENDING_CLAIM_GOODS_PLAN = 15000; // 待安排取货
        PENDING_SEND = 16000; // 待派送
        SEND_PLAN = 17000; // 派送处理中
        SEND_PLAN_PENDING_DRIVER = 17100; // 待分配司机
        SEND_PLAN_DRIVER = 17200; // 已分配司机
        SEND_PLAN_PENDING_JOB = 17300; // 待分配任务
        SEND_PLAN_JOB = 17400; // 已分配任务
        SEND_PLAN_PICKING = 17500; // 已拣货
        SEND_PLAN_PENDING_FIND = 17600; // 待找货
        SEND_PLAN_PENDING_TRUCK = 17700; // 待装车
        SENDING = 18000; // 派送中
        SENDING_SELF_PICK = 19000; // 送往自取仓库
        SELF_PICK_STORE_ARRIVE = 20300; // 到达自取仓库
        SELF_PICK_STORE_PUTAWAY = 20700; // 到达自取仓库
        FINISH = 21000; // 完成
    }
    OrderItemStatus status = 3;
    QueryResult result = 4; // 查询是否成功
}

message QueryResult {
    enum ErrorCode {
        SUCCESS = 0;
        SYSTEM_ERROR = 1; // 系统错误，如数据库报错等
        NO_RECORD = 2; // 没有数据
    }
    ErrorCode code = 1;
}

message NewOrderPackage {
    int64 orderId = 1;
    int64 packageId = 2;
    repeated int64 orderItemId = 3;
}

message NewParcelOrder {
    int64 parcelId = 1;
    repeated int64 orderId = 2;
}

message NewThirdPartyStatusBatch {
    repeated PackageThirdParty packageThirdPartyList = 1;
}

message PackageThirdParty {
    int64 packageId = 1;
    repeated ThirdPartyStatus thirdPartyStatusList = 2;
}

message ThirdPartyStatus {
    string status = 1;
    string info = 2;
    int64 time = 3;
}

service Status {
    // 生成二级包裹时需要调用此接口，记录订单和二级包裹的对应关系，并初始化二级包裹状态
    rpc CreateOrderPackage (NewOrderPackage) returns (UpdateResult);

    // 生成Parcel时需要调用此接口，记录Parcel和订单的对应关系
    rpc CreateParcelOrder (NewParcelOrder) returns (UpdateResult);

    rpc GetOrderItemStatus (OrderItem) returns (OrderItemStatusResult);
    rpc GetOrderItemStatusBatch (OrderItemBatch) returns (OrderItemStatusResultBatch);

    rpc ForceSetOrderItemStatusBatch (ForceNewOrderItemStatusBatch) returns (OrderItemBatchUpdateResult); // 不检查设置的合法性，直接设置
    rpc OnlyGetOrderItemStatusBatch (OrderBatch) returns (OrderItemStatusResultBatch); // 只获得orderItem的状态，不关联订单和包裹状态
    rpc OnlyGetOrderItemStatusBatchByOrderItemId (OrderItemBatch) returns (OrderItemStatusResultBatch); // 只获得orderItem的状态，不关联订单和包裹状态

    // 生成订单时需要调用此接口初始化OrderItem状态
    rpc SetOrderItemStatus (NewOrderItemStatus) returns (UpdateResult);
    // 生成订单时需要调用此接口初始化OrderItem状态
    rpc CreateOrderItemStatusBatch (NewOrderItemStatusBatch) returns (UpdateResult);
    // 生成订单时需要调用此接口初始化OrderItem状态，如果是新建orderItem的状态，建议使用CreateOrderItemStatusBatch
    rpc SetOrderItemStatusBatch (NewOrderItemStatusBatch) returns (UpdateResultBatch);
    rpc CASSetOrderItemStatus (CASNewOrderItemStatus) returns (OrderItemStatusResult); // compare and set 模式
    rpc CASSetOrderItemStatusFromMultiStatus (CASNewOrderItemStatusFromMultiStatus) returns (OrderItemStatusResult); // compare and set 模式，允许从多个状态设置为一个状态
    rpc GetPackageStatus (Package) returns (PackageStatusResult);
    rpc SetPackageStatus (NewPackageStatus) returns (UpdateResult);
    rpc SetPackageStatusBatch (NewPackageStatusBatch) returns (UpdateResult);
    rpc GetParcelStatus (Parcel) returns (ParcelStatusResult);
    rpc SetParcelStatus (NewParcelStatus) returns (UpdateResult);
    rpc GetOrderStatus (Order) returns (OrderStatusResult);
    rpc GetOrderStatusBatch (OrderBatch) returns (OrderStatusResultBatch);
    rpc SetOrderStatus (NewOrderStatus) returns (UpdateResult);
    rpc SetOrderStatusBatch (NewOrderStatusBatch) returns (UpdateResultBatch);

    // 根据包裹id，获得第三方物流状态列表
    rpc GetThirdPartyStatusList (Package) returns (PackageThirdParty);
    // 设置第三方物流状态
    rpc SetThirdPartyStatusBatch (NewThirdPartyStatusBatch) returns (UpdateResult);
}
